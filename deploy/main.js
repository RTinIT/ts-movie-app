(()=>{"use strict";const t=function(){function t(t,e,n,o){void 0===e&&(e="div"),void 0===n&&(n=""),void 0===o&&(o="");var r=document.createElement(e);r.className=n,r.innerHTML=o,t&&t.append(r),this.node=r}return t.prototype.destroy=function(){this.node.remove()},t}();var e,n=(e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)});const o=function(e){function o(t,n){var o=e.call(this,t,"div","card")||this;return o.data=n,o.node.setAttribute("data-filmid","".concat(n.filmId)),o.data.nameRu?o.render(n):o.destroy(),o}return n(o,e),o.prototype.render=function(e,n){new t(this.node,"div","card__img").node.style.backgroundImage="url(".concat(e.posterUrl,")"),new t(this.node,"button","card__btn","Узнать больше")},o}(t);var r=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const i=function(t){function e(e,n){var r=t.call(this,e,"div","card-field")||this;return r.cardList=[],n.forEach((function(t){var e=new o(r.node,t);r.cardList.push(e)})),r}return r(e,t),e.prototype.clearCardList=function(){this.cardList=[]},e}(t),s=function(){function e(){this.form=document.createElement("form"),this.input=document.createElement("input"),this.value=this.input.value}return e.prototype.render=function(e){var n=new t(e,"div","form-wrapper"),o=new t(n.node,"div","logo-wrapper");new t(o.node,"div","img"),new t(o.node,"h1","logo","Movie App"),this.form.className="form",this.input.className="input",this.input.setAttribute("placeholder","Название фильма"),this.input.setAttribute("autofocus",""),this.form.append(this.input),n.node.append(this.form),this.backBtn=new t(n.node,"button","additional-info__back-btn invisible","Назад"),e.append(n.node)},e.prototype.getValue=function(){return this.input.value},e.prototype.hideOrShow=function(t,e){t.classList.contains("invisible")?e.classList.remove("invisible"):e.classList.add("invisible")},e}();function a(t){return t.map((function(t){return Object.values(t)})).slice(0,3).join(", ")}function c(t,e){return"DIRECTOR"===e?t.filter((function(t){return t.professionKey===e})).map((function(t){return t.nameRu})).join(", "):t.filter((function(t){return t.professionKey===e})).slice(0,5).map((function(t){return t.nameRu})).join(", ")}var u=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=function(e){function n(n,o){for(var r=e.call(this,n,"div","text-wrapper__item")||this,i=Math.floor(o),s=Math.round(100*(o-i)),a=10-Math.ceil(o),c=(new t(r.node,"p","rating__title","Рейтинг: "),new t(r.node,"div","rating__stars")),u=(new t(c.node,"div","rating__svg-masks",'\n  <svg style="width: 0; height: 0;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">\n    <defs>\n      <mask id="half">\n        <rect x="0" y="0" width="32" height="32" fill="white" />\n        <rect x="'.concat(s,'%" y="0" width="32" height="32" fill="black" />\n      </mask>\n\n      <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="star">\n        <path d="M31.547 12a.848.848 0 00-.677-.577l-9.427-1.376-4.224-8.532a.847.847 0 00-1.516 0l-4.218 8.534-9.427 1.355a.847.847 0 00-.467 1.467l6.823 6.664-1.612 9.375a.847.847 0 001.23.893l8.428-4.434 8.432 4.432a.847.847 0 001.229-.894l-1.615-9.373 6.822-6.665a.845.845 0 00.214-.869z" />\n      </symbol>\n    </defs>\n  </svg>\n')),new t(c.node,"div","rating__svg-stars")),l=0;l<i;l++)u.node.innerHTML+='\n  <svg class="c-star active" width="32" height="32" viewBox="0 0 32 32">\n    <use xlink:href="#star"></use>\n    <use xlink:href="#star" fill="none" stroke="grey"></use>\n  </svg>\n';for(s&&(u.node.innerHTML+='\n  <svg class="c-star active" width="32" height="32" viewBox="0 0 32 32">\n    <use xlink:href="#star" mask=url("#half")></use>\n    <use xlink:href="#star" fill="none" stroke="grey"></use>\n  </svg>\n'),l=0;l<a;l++)u.node.innerHTML+='\n  <svg class="c-star" width="32" height="32" viewBox="0 0 32 32">\n    <use xlink:href="#star"></use>\n    <use xlink:href="#star" fill="none" stroke="grey"></use>\n  </svg>\n';return r}return u(n,e),n}(t),p=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const d=function(e){function n(n,o){var r=e.call(this,n,"ol","bot-section__facts-list")||this;o.total||r.destroy(),r.facts=o.items.map((function(t){return t.text}));var i=new t(r.node,"details","facts-list__details");return new t(i.node,"summary","","Интересные факты"),r.renderFacts(i.node),r}return p(n,e),n.prototype.renderFacts=function(e){this.facts.forEach((function(n){new t(e,"li","facts-list__item","".concat(n))}))},n}(t);var f=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const h=function(e){function n(n,o){var r=e.call(this,n,"div","slider__item")||this;return new t(r.node,"img","slider-item__img").node.setAttribute("src","".concat(o.imageUrl)),r}return f(n,e),n}(t);var v=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const y=function(e){function n(n,o){var r=e.call(this,n,"div","mid-section__slider")||this;return o.total||r.destroy(),r.start=0,r.step=innerWidth>830?750:300,r.dataLength=o.total,r.content=new t(r.node,"div","slider__content"),r.renderSliderItem(o),window.addEventListener("resize",(function(){r.step=innerWidth>830?750:300})),r.prevBtn=new t(r.node,"button","slider__prev-btn"),r.nextBtn=new t(r.node,"button","slider__next-btn"),1===r.dataLength&&(r.prevBtn.node.classList.add("hidden"),r.nextBtn.node.classList.add("hidden")),r.nextBtn.node.onclick=function(){return r.next()},r.prevBtn.node.onclick=function(){return r.prev()},r}return v(n,e),n.prototype.renderSliderItem=function(t){var e=this;this.dataLength>=10?(this.dataLength=10,t.items.slice(0,10).forEach((function(t){new h(e.content.node,t)}))):t.items.forEach((function(t){new h(e.content.node,t)}))},n.prototype.next=function(){this.start!==-(this.dataLength*this.step-this.step)?(this.content.node.style.transform="translate(".concat(this.start-this.step,"px)"),this.start=parseInt(this.content.node.style.transform.slice(10))):(this.start=0,this.content.node.style.transform="translate(".concat(this.start,"px)"))},n.prototype.prev=function(){this.start?(this.content.node.style.transform="translate(".concat(this.start+this.step,"px)"),this.start=parseInt(this.content.node.style.transform.slice(10))):(this.start=-(this.dataLength*this.step-this.step),this.content.node.style.transform="translate(".concat(this.start,"px)"))},n}(t);var w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const _=function(e){function n(n,o){var r=e.call(this,n,"div","bot-section__player")||this;if(o.total&&0!==r.filterByYT(o).length){new t(r.node,"h3","player__title","Смотреть трейлер");var i=new t(r.node,"iframe","video");i.node.setAttribute("src","".concat(r.urlHandle(o))),i.node.setAttribute("title","YouTube video player"),i.node.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),i.node.setAttribute("allowfullscreen","")}else r.destroy();return r}return w(n,e),n.prototype.urlHandle=function(t){var e=this.filterByYT(t)[0].url.split("/");return"https://www.youtube.com/embed/".concat(e.slice(-1))},n.prototype.filterByYT=function(t){return t.items.filter((function(t){return"YOUTUBE"===t.site}))},n}(t);var m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const b=function(e){function n(n,o,r){var i=e.call(this,n,"p","text-wrapper__item")||this;return new t(i.node,"span","item__content","".concat(o,":")),new t(i.node,"span","item__content","".concat(r)),i}return m(n,e),n}(t);var g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const O=function(e){function n(n,o){var r=e.call(this,n,"div","additional-info")||this,i=o[0],s=o[1],u=o[2],p=o[3],f=o[4],h=new t(r.node,"section","additional-info__top-section"),v=new t(r.node,"section","additional-info__mid-section"),w=new t(r.node,"section","additional-info__bot-section");u.total||r.hasVideoData(o)||w.destroy();var m=new t(h.node,"div","top-section__img-wrapper");new t(m.node,"img","img-wrapper__img").node.setAttribute("src","".concat(i.posterUrl));var g,O=new t(h.node,"div","top-section__text-wrapper"),k=(new t(O.node,"h2","text-wrapper__title","".concat(i.nameRu)),new b(O.node,"Жанр","".concat(a(i.genres))),new b(O.node,"Страна","".concat(a(i.countries))),new b(O.node,"Год выпуска","".concat(i.year?i.year:"-")),new b(O.node,"Режисёры","".concat(c(s,"DIRECTOR"))),new b(O.node,"В ролях","".concat(c(s,"ACTOR"))),new l(O.node,i.ratingKinopoisk)),x=(g=i.ratingKinopoisk,"null"!=="".concat(g)?"".concat(g):"-"),L=new t(k.node,"div","rating__count",x);return r.makeRateBorder(x,L.node),new t(v.node,"h3","mid-section__text-title","Краткое описание"),new t(v.node,"p","mid-section__text","".concat(i.description?i.description:"")),new y(v.node,p),new _(w.node,f),new d(w.node,u),r}return g(n,e),n.prototype.hasVideoData=function(t){return 0!==t[4].items.filter((function(t){return"YOUTUBE"===t.site})).length},n.prototype.makeRateBorder=function(t,e){isNaN(+t)&&e.classList.add("empty-rate"),+t>=7&&e.classList.add("high-rate"),+t<7&&e.classList.add("low-rate")},n}(t);var k=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const x=function(e){function n(n){var o=e.call(this,n,"div","footer")||this,r=new t(o.node,"div","footer__content");return new t(r.node,"a","content__item","my_github").node.setAttribute("href","https://github.com/RTinIT"),new t(r.node,"p","content__item","© 2022"),o}return k(n,e),n}(t),L=function(){function e(){this.search=new s}return e.prototype.start=function(e){this.root=new t(document.body,"div","root"),this.search.render(this.root.node),this.cardFieldWrapper=new t(this.root.node,"div","card-field-wrapper"),this.cardField=new i(this.cardFieldWrapper.node,e.films),new x(this.root.node)},e.prototype.update=function(t){this.cardField.destroy(),this.cardField=new i(this.cardFieldWrapper.node,t.films)},e.prototype.renderAdditionalView=function(t,e){this.cardField.destroy(),this.additionalView=new O(t,e),window.scrollTo({top:0})},e}();var j=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},E=function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};const T=function(){function t(){this.apiKey="1a5db326-08fe-414f-8a22-62e0e9615e74",this.defaltPage="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page=1",this.searchUrl="https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=",this.searchByIdUrl="https://kinopoiskapiunofficial.tech/api/v2.2/films/",this.searchActors="https://kinopoiskapiunofficial.tech/api/v1/staff?filmId=",this.movieFacts="https://kinopoiskapiunofficial.tech/api/v2.2/films/",this.frameMovie="https://kinopoiskapiunofficial.tech/api/v2.2/films/",this.video="https://kinopoiskapiunofficial.tech/api/v2.2/films/",this.headers={"Content-Type":"application/json","X-API-KEY":this.apiKey}}return t.prototype.getData=function(t){return j(this,void 0,void 0,(function(){return E(this,(function(e){switch(e.label){case 0:return t?[4,fetch("".concat(this.searchUrl).concat(t),{headers:this.headers})]:[3,2];case 1:case 3:return[2,e.sent().json()];case 2:return[4,fetch(this.defaltPage,{headers:this.headers})]}}))}))},t.prototype.getDataByFilmId=function(t){return j(this,void 0,void 0,(function(){var e,n,o,r;return E(this,(function(i){switch(i.label){case 0:return i.trys.push([0,11,,12]),n=(e=Promise).all,[4,fetch("".concat(this.searchByIdUrl).concat(t),{headers:this.headers})];case 1:case 3:case 5:case 7:case 9:return[4,i.sent().json()];case 2:return o=[i.sent()],[4,fetch("".concat(this.searchActors).concat(t),{headers:this.headers})];case 4:return o=o.concat([i.sent()]),[4,fetch("".concat(this.movieFacts).concat(t,"/facts"),{headers:this.headers})];case 6:return o=o.concat([i.sent()]),[4,fetch("".concat(this.frameMovie).concat(t,"/images?type=STILL&page=1"),{headers:this.headers})];case 8:return o=o.concat([i.sent()]),[4,fetch("".concat(this.video).concat(t,"/videos"),{headers:this.headers})];case 10:return[2,n.apply(e,[o.concat([i.sent()])])];case 11:return r=i.sent(),console.log("Возникли проблемы",r.message),[3,12];case 12:return[2]}}))}))},t}();(new(function(){function t(){this.view=new L,this.model=new T,this.choosedCard={name:"",id:""}}return t.prototype.init=function(){var t=this;this.model.getData().then((function(e){t.view.start(e),t.setEventListeners(e)}))},t.prototype.setEventListeners=function(t){var e=this;this.view.search.form.addEventListener("submit",(function(t){t.preventDefault(),e.searching()})),this.view.search.backBtn.node.addEventListener("click",(function(){var n=e.view.search.backBtn.node,o=e.view.search.form;e.view.additionalView.destroy(),e.view.update(t),e.setEventListeners(t),n.classList.add("invisible"),o.classList.remove("invisible"),e.view.cardField.clearCardList()})),this.view.cardField.cardList.forEach((function(t){t.node.addEventListener("click",(function(t){var n=e.view.search.form,o=e.view.search.backBtn.node;e.recChoosedCard(t),e.getAdditionalInfo(),n.classList.add("invisible"),o.classList.remove("invisible")}))}))},t.prototype.searching=function(){var t=this,e=this.view.search.getValue();this.model.getData(e).then((function(e){var n=t.view.search.backBtn.node,o=t.view.search.input;t.view.update(e),t.setEventListeners(e),t.view.search.hideOrShow(n,o)}))},t.prototype.recChoosedCard=function(t){var e=t.currentTarget,n=e.dataset.filmid,o=e.dataset.filmname;this.choosedCard.name=o,this.choosedCard.id=n},t.prototype.getAdditionalInfo=function(){var t=this;this.model.getDataByFilmId(this.choosedCard.id).then((function(e){t.view.renderAdditionalView(t.view.cardFieldWrapper.node,e)}))},t}())).init()})();