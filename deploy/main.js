(()=>{"use strict";const t=function(){function t(t,e,n,o){void 0===e&&(e="div"),void 0===n&&(n=""),void 0===o&&(o="");var r=document.createElement(e);r.className=n,r.innerHTML=o,t&&t.append(r),this.node=r}return t.prototype.destroy=function(){this.node.remove()},t}();var e,n=(e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)});const o=function(e){function o(t,n){var o=e.call(this,t,"div","card")||this;return o.data=n,o.node.setAttribute("data-filmid","".concat(n.filmId)),o.data.nameRu?o.render(n):o.destroy(),o}return n(o,e),o.prototype.render=function(e,n){new t(this.node,"div","card__img").node.style.backgroundImage=this.checkPoster(e),new t(this.node,"button","card__btn","Узнать больше")},o.prototype.checkPoster=function(t){if(t.posterUrl)return"url(".concat(t.posterUrl,")");this.destroy()},o}(t);var r=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const i=function(e){function n(n,r){var i=e.call(this,n,"div","card-field")||this;i.cardList=[],r.forEach((function(t){var e=new o(i.node,t);i.cardList.push(e)}));var c=new t(i.node,"a","scroll-to-top"),s=new t(c.node,"img","");return s.node.setAttribute("src","/public/arrow-up.svg"),s.node.setAttribute("alt",""),c.node.setAttribute("href","#logo"),i}return r(n,e),n}(t),c=function(){function e(){this.form=document.createElement("form"),this.input=document.createElement("input")}return e.prototype.render=function(e){var n=new t(e,"div","form-wrapper"),o=new t(n.node,"div","logo-wrapper");new t(o.node,"h1","logo","Movie App").node.id="logo",this.form.className="form",this.input.className="input",this.input.id="input",this.input.setAttribute("required",""),this.input.setAttribute("autocomplete","off");var r=new t(this.form,"div","input-wrapper");r.node.append(this.input),new t(r.node,"label","input-wrapper__label","Поиск").node.setAttribute("for","input"),new t(r.node,"div","input-wrapper__underline"),this.form.append(r.node),n.node.append(this.form),e.append(n.node)},e.prototype.getValue=function(){return this.input.value},e.prototype.clearInput=function(){this.input.value=""},e}();var s=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const a=function(t){function e(e){var n=t.call(this,e,"header","header")||this;return n.search=new c,n.search.render(n.node),n}return s(e,t),e}(t);var u=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const p=function(e){function n(n){var o=e.call(this,n,"footer","footer")||this,r=new t(o.node,"div","footer__content");return new t(r.node,"a","content__item","my_github").node.setAttribute("href","https://github.com/RTinIT"),new t(r.node,"p","content__item","© 2022"),o}return u(n,e),n}(t);function l(t){return t.map((function(t){return Object.values(t)})).slice(0,3).join(", ")}function d(t,e){return"DIRECTOR"===e?t.filter((function(t){return t.professionKey===e})).map((function(t){return t.nameRu})).join(", "):t.filter((function(t){return t.professionKey===e})).slice(0,5).map((function(t){return t.nameRu})).join(", ")}var f=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=function(e){function n(n,o){for(var r=e.call(this,n,"div","text-wrapper__item")||this,i=Math.floor(o),c=Math.round(100*(o-i)),s=10-Math.ceil(o),a=(new t(r.node,"p","rating__title","Рейтинг: "),new t(r.node,"div","rating__stars")),u=(new t(a.node,"div","rating__svg-masks",'\n  <svg style="width: 0; height: 0;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">\n    <defs>\n      <mask id="half">\n        <rect x="0" y="0" width="32" height="32" fill="white" />\n        <rect x="'.concat(c,'%" y="0" width="32" height="32" fill="black" />\n      </mask>\n\n      <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="star">\n        <path d="M31.547 12a.848.848 0 00-.677-.577l-9.427-1.376-4.224-8.532a.847.847 0 00-1.516 0l-4.218 8.534-9.427 1.355a.847.847 0 00-.467 1.467l6.823 6.664-1.612 9.375a.847.847 0 001.23.893l8.428-4.434 8.432 4.432a.847.847 0 001.229-.894l-1.615-9.373 6.822-6.665a.845.845 0 00.214-.869z" />\n      </symbol>\n    </defs>\n  </svg>\n')),new t(a.node,"div","rating__svg-stars")),p=0;p<i;p++)u.node.innerHTML+='\n  <svg class="c-star active" width="32" height="32" viewBox="0 0 32 32">\n    <use xlink:href="#star"></use>\n    <use xlink:href="#star" fill="none" stroke="grey"></use>\n  </svg>\n';for(c&&(u.node.innerHTML+='\n  <svg class="c-star active" width="32" height="32" viewBox="0 0 32 32">\n    <use xlink:href="#star" mask=url("#half")></use>\n    <use xlink:href="#star" fill="none" stroke="grey"></use>\n  </svg>\n'),p=0;p<s;p++)u.node.innerHTML+='\n  <svg class="c-star" width="32" height="32" viewBox="0 0 32 32">\n    <use xlink:href="#star"></use>\n    <use xlink:href="#star" fill="none" stroke="grey"></use>\n  </svg>\n';return r}return f(n,e),n}(t),y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const w=function(e){function n(n,o,r){var i=e.call(this,n,"p","text-wrapper__item")||this;return r||i.destroy(),new t(i.node,"span","item__content","".concat(o,":")),new t(i.node,"span","item__content","".concat(r)),i}return y(n,e),n}(t);var v=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const _=function(e){function n(n,o){var r=e.call(this,n,"div","details")||this,i=o[0],c=o[1],s=new t(r.node,"section","details__top-section"),a=new t(s.node,"div","top-section__img-wrapper"),u=new t(a.node,"img","img-wrapper__img");u.node.setAttribute("src","".concat(i.posterUrl)),u.node.setAttribute("alt","Постер ".concat(i.nameRu?i.nameRu:i.nameEn));var p,f=new t(s.node,"div","top-section__text-wrapper"),y=(new t(f.node,"h2","text-wrapper__title","".concat(i.nameRu)),new w(f.node,"Жанр","".concat(l(i.genres))),new w(f.node,"Страна","".concat(l(i.countries))),new w(f.node,"Год выпуска","".concat(i.year?i.year:"-")),new w(f.node,"Режисёры","".concat(d(c,"DIRECTOR"))),new w(f.node,"В ролях","".concat(d(c,"ACTOR"))),new h(f.node,i.ratingKinopoisk)),v=(p=i.ratingKinopoisk,"null"!=="".concat(p)?"".concat(p):"-"),_=new t(y.node,"div","rating__count",v);return r.setBorder(v,_.node),new t(f.node,"p","text-wrapper__description","".concat(i.description?i.description:"")),r}return v(n,e),n.prototype.setBorder=function(t,e){isNaN(+t)&&e.classList.add("empty-rate"),+t>=7&&e.classList.add("high-rate"),+t<7&&e.classList.add("low-rate")},n}(t);var m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const g=function(e){function n(n,o){var r=e.call(this,n,"div","modal")||this;return r.data=o,r.closeBtn=new t(r.node,"div","modal__close-btn"),r.closeBtn.node.onclick=function(){return r.hide()},r.line1=new t(r.closeBtn.node,"span",""),r.line2=new t(r.closeBtn.node,"span",""),r.detailsInfo=new _(r.node,o),r}return m(n,e),n.prototype.hide=function(){var t=this;document.body.classList.remove("blocked"),this.node.classList.add("exit"),setTimeout((function(){t.destroy()}),200)},n}(t),b=function(){function e(){}return e.prototype.start=function(e){this.root=new t(document.body,"div","root"),this.header=new a(this.root.node),this.cardFieldWrapper=new t(this.root.node,"div","card-field-wrapper"),this.cardField=new i(this.cardFieldWrapper.node,e.films),new p(this.root.node)},e.prototype.update=function(t){this.cardField.destroy(),this.cardField=new i(this.cardFieldWrapper.node,t.films)},e.prototype.showModal=function(t){this.modal=new g(this.root.node,t)},e}();var O=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{a(o.next(t))}catch(t){i(t)}}function s(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}a((o=o.apply(t,e||[])).next())}))},k=function(t,e){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};const x=function(){function t(){this.apiKey="1a5db326-08fe-414f-8a22-62e0e9615e74",this.defaultPage="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page=1",this.searchUrl="https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=",this.searchByIdUrl="https://kinopoiskapiunofficial.tech/api/v2.2/films/",this.searchActors="https://kinopoiskapiunofficial.tech/api/v1/staff?filmId=",this.headers={"Content-Type":"application/json","X-API-KEY":this.apiKey}}return t.prototype.getData=function(t){return O(this,void 0,void 0,(function(){return k(this,(function(e){switch(e.label){case 0:return t?[4,fetch("".concat(this.searchUrl).concat(t),{headers:this.headers})]:[3,2];case 1:case 3:return[2,e.sent().json()];case 2:return[4,fetch(this.defaultPage,{headers:this.headers})]}}))}))},t.prototype.getDataByFilmId=function(t){return O(this,void 0,void 0,(function(){var e,n,o,r;return k(this,(function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),n=(e=Promise).all,[4,fetch("".concat(this.searchByIdUrl).concat(t),{headers:this.headers})];case 1:case 3:return[4,i.sent().json()];case 2:return o=[i.sent()],[4,fetch("".concat(this.searchActors).concat(t),{headers:this.headers})];case 4:return[2,n.apply(e,[o.concat([i.sent()])])];case 5:return r=i.sent(),console.log("Возникли проблемы",r.message),[3,6];case 6:return[2]}}))}))},t}();(new(function(){function t(){this.view=new b,this.model=new x,this.selectedCard={name:"",id:""}}return t.prototype.init=function(){var t=this;this.model.getData().then((function(e){t.view.start(e),t.setEventListeners(e)}))},t.prototype.setEventListeners=function(t){var e=this;this.view.header.search.form.addEventListener("submit",(function(t){t.preventDefault(),e.searching()})),this.view.cardField.cardList.forEach((function(t){t.node.addEventListener("click",(function(t){document.body.classList.add("blocked"),e.saveSelectedCard(t),e.getAdditionalInfo()}))}))},t.prototype.searching=function(){var t=this,e=this.view.header.search.getValue();this.view.header.search.clearInput(),this.model.getData(e).then((function(e){t.view.update(e),t.setEventListeners(e)}))},t.prototype.saveSelectedCard=function(t){var e=t.currentTarget,n=e.dataset.filmid,o=e.dataset.filmname;this.selectedCard.name=o,this.selectedCard.id=n},t.prototype.getAdditionalInfo=function(){var t=this;this.model.getDataByFilmId(this.selectedCard.id).then((function(e){t.view.showModal(e)}))},t}())).init()})();